<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <title>Калькулятор НДС</title>
    <style>
        form {
            margin-bottom: 20px;
        }
        #result {
            margin-top: 20px;
        }
    </style>
</head>
<body>

<h2>Калькулятор НДС</h2>

<form id="form">
    <em>Сумма, руб.</em>
    <br>
    <input type="text" id="sum" value="">
    <br>

    <em>Ставка, %</em>
    <br>
    <input type="text" id="stav" value="20">
    <br>

    <label>
        <input name="rd" type="radio" value="1" checked> Начислить НДС
    </label>
    <br>
    <label>
        <input name="rd" type="radio" value="2"> Выделить НДС
    </label>
</form>

<div id="result"></div>

<br>

<script>
    function okr(a) {
        return Number(Math.abs(a)).toLocaleString('ru-RU', { minimumFractionDigits: 2, maximumFractionDigits: 2 });
    }

    function do_c(a) {
        a = a.replace(/[^0-9,.]/g, '');
        a = a.replace(',', '.');
        return parseFloat(a) || 0;
    }

    function nds1(sum, stav) {
        const sum_b = sum;
        const nds = sum * stav / 100;
        const sum_s = sum + nds;

        return `
            Сумма без НДС: <b>${okr(sum_b)} руб.</b><br>
            НДС: <b>${okr(nds)} руб.</b><br>
            Сумма с НДС: <b>${okr(sum_s)} руб.</b><br>
        `;
    }

    function nds2(sum, stav) {
        const sum_s = sum;
        const sum_b = sum / (100 + stav) * 100;
        const nds = sum_s - sum_b;

        return `
            Сумма без НДС: <b>${okr(sum_b)} руб.</b><br>
            НДС: <b>${okr(nds)} руб.</b><br>
            Сумма с НДС: <b>${okr(sum_s)} руб.</b><br>
        `;
    }

    function calculate() {
        const sum = do_c(document.getElementById('sum').value);
        const stav = do_c(document.getElementById('stav').value);
        const rd = document.querySelector('input[name="rd"]:checked').value;

        let error = '';
        if (sum === 0) error += 'Не указана сумма<br>';
        if (sum > 20000000000) error += 'Слишком большая сумма<br>';
        if (stav === 0) error += 'Не указана ставка НДС<br>';
        if (stav > 99) error += 'Некорректная ставка НДС<br>';

        if (error) {
            document.getElementById('result').innerHTML = error;
        } else {
            const result = rd == 1 ? nds1(sum, stav) : nds2(sum, stav);
            document.getElementById('result').innerHTML = result;
        }
    }

    document.getElementById('sum').addEventListener('input', calculate);
    document.getElementById('stav').addEventListener('input', calculate);
    document.querySelectorAll('input[name="rd"]').forEach(radio => {
        radio.addEventListener('change', calculate);
    });

    // Инициализация расчета при загрузке страницы
    document.addEventListener('DOMContentLoaded', calculate);
</script>

</body>
</html>